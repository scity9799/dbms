day21 (DBMS 3일차)
복습 -> DDL2(테이블 관계) -> 무결성 -> 모델링(기획)★★★ -> 이상현상

--- CMD에서 hr에 있는 권한을 kdt로 넘겨주는 문 ---
┌───────────────────────────────────────────────────────────────────────────────┐
│Enter user-name: sys as sysdba							│
│Enter password:								│
│										│
│Connected to:									│
│Oracle Database 11g Express Edition Release 11.2.0.2.0 - 64bit Production	│
│										│
│SQL> conn hr/1234;								│
│Connected.									│
│SQL> grant select on employees to kdt;						│
│										│
│Grant succeeded.								│
│										│
│SQL> conn kdt/1234								│
│Connected.									│
│SQL> select * from hr.employees;						│
└───────────────────────────────────────────────────────────────────────────────┘

0. 복습
1) 쿼리문 종류
	DDL	CREATE, ALTER, DROP, TRUNCATE
		데이터 구조(테이블/유저 등 정의)를 만들고 바꾸는 명령어
	DML	SELECT, INSERT, UPDATE, DELETE
		데이터 자체를 바꾸는 명령어
	DCL	GRANT, REVOKE
		권한 부여/회수와 관련된 명령어
	TCL	COMMIT, ROLLBACK, SAVEPOINT
		트랙잭션 제어와 관련된 명령어

2) DML
- SELECT
	SELECT [DISTINCT] 컬럼명 [AS 별칭]
	FROM 테이블명
	[WHERE 조건]
	[ORDER BY 기준컬럼 [ASC/DESC]];

- INSERT
	INSERT INTO 테이블명
	VALUES(값1,값2,...)

- UPDATE
	UPDATE 테이블명
	SET 기존 컬럼명 = 변경할 값, 기존 컬럼명 = 변경할 값
	[WHERE 조건식];

- DELETE
	DELETE FROM 테이블명
	[WHERE 조건식];

3) DCL
- CREATE
	CREATE TABLE 테이블명(
		컬럼명 자료형(용량) [제약조건]
		컬럼명 자료형(용량).
		[제약조건]
	);

	CREATE USER 계정명 IDENTIFIED BY 비밀번호;
	GRANT CREATE SESSION, CONNECT, RESOURCE TO 계정명;

- DROP
	DROP TABLE 테이블명;

- ALTER 
	ALTER TABLE 테이블명
		테이블명 수정	RENAME TO 새로운 테이블명
		컬럼명 수정		RENAME COLUMN 기존컬럼명 TO 변경할컬럼명
		컬럼타입 수정	MODIFIY(기존컬럼명 자료형(용량))
		컬럼 추가		ADD (새로운컬럼명 자료형(용량))
		컬럼 삭제 		DROP COLUMN 기존컬럼명;
		제약조건 추가	CONSTRAINT 제약조건이름 제약조건(현재테이블의 컬럼명);
		제약조건 삭제	DROP CONSTRAINT 제약조건이름;

- TRUNCATE
	TRUNCATE TABLE 테이블명;

4) 키의 종류
키(Key) : 데이터베이스 내의 레코드를 고유하게 식별하거나 검색하는데 사용되는 하나 이상의 속성의 집합
	- 모델링에서 사용(식별자) : 기본키, 외래키, 후보키, 대체키, 슈퍼키
	- 테이블에서 사용(키) : 기본키, 외래키, 조합키
- 기본키(Primary Key)
	테이블 내의 각 행을 고유하게 식별하는데 사용
	중복 불가, null 불가

- 외래키(Foreign Key)
	두 테이블 간의 관계를 설정하고 데이터 무결성을 유지

- 조합키(복합키)
	두 개 이상의 컬럼을 하나의 key로 지정하는 것
	모든 테이블은 하나의 PK만 존재하지만 조합키를 사용하여 두 개 이상의 컬럼을 하나의 PK로 사용할 수 있다

- 후보키(Candidate Key)
	기본키가 될 수 있는 키(기본키의 후보)

- 대체키(Alternate Key)
	후보키에서 기본키로 선택되지 않은 후보키

- 슈퍼키(Super Key)
	레코드를 고유하게 식별하기 위한 속성 또는 속성의 집합
	슈퍼키는 후보키와 대체키의 상위 키

5) 제약조건
- Primary Key(PK)
	고유한 값이며 각 행의 구분점으로 사용된다
	중복 불가, null 불가

- Foreign Key(FK)
	다른 테이블의 PK를 사용하며 중복 가능하다
	보통 테이블끼리 관계를 맺을 때 사용한다(참조무결성)
	null 값 허용

- UNIQUE(UK)
	해당 컬럼에서 중복값이 없는 고유값으로 사용해야한다
	null 값 허용

- CHECK(CHK)
	컬럼의 값이 특정 조건을 만족해야한다(값의 범위나 조건 사용)

- NOT NULL(NN, N/N)
	해당 컬럼의 값은 null 값 허용하지 않는다

- DEFAULT
	해당 컬럼의 값이 입력되지 않을 경우 기본값으로 자동입력된다
	지정하지 않을 경우 null이 자동으로 사용된다

1. DDL 2
1) 테이블 구조 수정
ALTER TABLE 테이블명
		테이블명 수정	RENAME TO 새로운 테이블명
		컬럼명 수정		RENAME COLUMN 기존컬럼명 TO 변경할컬럼명
		컬럼타입 수정	MODIFIY(기존컬럼명 자료형(용량))
		컬럼 추가		ADD (새로운컬럼명 자료형(용량))
		컬럼 삭제 		DROP COLUMN 기존컬럼명;
		제약조건 추가	CONSTRAINT 제약조건이름 제약조건(현재테이블의 컬럼명);
		제약조건 삭제	DROP CONSTRAINT 제약조건이름;

2) FK 옵션 종류
- ON DELETE CASCADE
	부모를 삭제하면 자식도 자동 삭제됨

	CONSTRAINT 제약조건이름 FOREIGN KEY(현재테이블컬럼명) REFERENCES 참조할테이블명(참조컬럼명)
	ON DELETE CASCADE

- ON DELETE SET NULL
	부모를 삭제하면 자식 FK를 NULL로 변경

	CONSTRAINT 제약조건이름 FOREIGN KEY(현재테이블컬럼명) REFERENCES 참조할테이블명(참조컬럼명)
	ON DELETE SET NULL

- ON DELETE RESTRICT(기본값)
	참조중이면 삭제 금지

2. 무결성 3가지 판단 요소
	무결성 : 데이터에 결함이 없다
		데이터의 정확성, 일관성, 유효성이 유지되는 것
		A라는 데이터에 결함이 없다 => 정확한 데이터이며 일관성이 있고, 유효성(실제 있는 데이터)
	
	정확성 : 데이터는 애매하지 않아야한다
	일관성 : 각 사용자가 일관된 데이터를 볼 수 있도록 해야한다
		고객테이블 : 홍길동
		주문테이블 : 홍길동
	유효성 : 데이터가 실제 존재하는 데이터여야한다

1) 개체 무결성(Primary Key)
	모든 테이블이 PK로 선택된 컬럼을 가져야한다

2) 참조 무결성(Foreign Key)
	두 테이블의 데이터가 항상 일관된 값을 가지도록 유지하는 것

3) 도메인 무결성(타입과 제약조건)
	컬럼의 타입, null 값 허용 등의 대한 사항을 정의하고 올바른 데이터가 입력되었는지를 확인하는 것

3. 모델링(기획) ★★★★★
	요구사항 분석 -> 개념적 설계 -> 논리적 설계 -> 물리적 설계 -> 구현

1) 요구사항 분석
	회원, 주문, 상품 : 3가지를 관리하고자한다
	회원 : 아이디, 비밀번호, 이름, 주소, 이메일, 생일
	주문 : 주문번호, 주문날짜
	상품 : 상품번호, 상품명, 가격, 재고량

2) 개념적 설계(개념모델링)
	회원	  	주문	 	상품			
	아이디	  	주문번호	 	상품번호		
	비밀번호	  	주문날짜	 	상품날짜		
	이름	  	아이디	 	가격		
	주소	  	상품번호	 	재고량		
	이메일		주문상태
	생일
	핸드폰번호	
  			
	- 관계를 맺을지, 독립적으로 유지될지 생각한다
	- 상위 테이블, 하위 테이블
	
	* 회원 1 : N 주문		한명의 회원이 여러건의 주문을 할 수 있다
	* 상품 1 : N 주문		한개의 상품은 여러건의 주문이 될 수 있다
	* 주문은 회원과 상품 사이의 다대 다 관계를 해소한 중간 엔티티

	회원은 회원정보만 있어도 된다, 주문이나 상품 정보를 넣을 필요가 없다
	상품은 상품 정보만 있으면 된다
	주문은 누가, 어떤 것을 주문했는지 알아야한다(회원, 상품)

3) 논리적 설계(논리모델링)

	회원	  	주문	   	상품			
	아이디(UK)문자  	주문번호(PK)숫자  	상품번호(PK)숫자	
	비밀번호 문자   	주문날짜 날짜   	상품명 문자		
	이름 문자	   	회원번호(FK) 숫자  	가격 숫자		
	주소 문자	   	상품번호(FK) 숫자 	재고량 숫자		
	이메일(UK) 문자  		   			
	생일 날짜
	회원번호(PK) 숫자		   			
	

4) 물리적 설계(물리모델링)
	테이블명, 컬럼명, 타입, 용량
	TBL_USER
	USER_ID : VACHAR2(100) : PRIMARY KEY
	-------------------------------------
	USER_PW : VARCHAR2(100)
	USER_NAME : VARCHAR2(100)
	USER_ADDRESS : VARCHAR2(100)
	USER_EMAIL : VARCHAR2(100)
	USER_BIRTH : DATE

5) 구현
	CREATE TABLE TBL_USER(
		USER_ID VACHAR2(100),
		USER_PW VARCHAR2(100),
		USER_NAME VARCHAR2(100),
		USER_ADDRESS VARCHAR2(100),
		USER_EMAIL VARCHAR2(100),
		USER_BIRTH DATE,
		CONSTRAINT PK_USER PRIMARY KEY(USER_ID),
		CONSTRAINT UK_USER UNIQUE(USER_EMAIL)
	);

+) 모델링
	데이터베이스 시스템에서 데이터의 구조와 관계를 설계하는 것을 의미

요구사항분석 : 비즈니스 관점에서 정리
	어떤 데이터를 관리할 것인지를 비즈니스 관점에서 정리
개념 모델링 : 언티티 도출
	현실 세계에 존재하는 정보 단위인 엔티티(Entity)를 사람이 이해할 수 있는 개념 세계의 정보 구조로 추상화하는 단계
논리 모델링 : 데이터의 속성, 키, 엔티티들의 관계 정의
	개념 세계의 정보구조를 정보시스템이 이해할 수 있는 형태로 표현한 단계(실질적인 데이터 모델링에 해당함)
물리 모델링 : 엔티티를 데이터베이스의 테이블로 구현, 테이블/키/제약조건 등을 정의
	정보시스템 세계의 논리적 구조를 정보시스템이 처리할 수 있는 형태로 구조화하는 단계
	구조화 된 결과는 데이터 스키마로 표현됨
구현 : SQL문을 사용하여 테이블 생성 및 데이터 삽입

개념적 설계			논리적 설계			물리적 설계
엔티티(Entity)		릴레이션(Relation)		테이블(Table)
릴레이션(Relation)		릴레이션(Relation)		컬럼(Column)
속성(Attribute)		속성(Attribute), 컬럼(Column)	행(Row)
주식별자(Main Identifier)	기본키(primary Key)	기본키(PK, Pirmary Key)
외래식별자(Foreign Key)	외래키(Foreign Key)	외래키(FK, Foreign Key)
인스턴스(Instance)		튜플(Tuple), 행(Row)	튜플(Tuple), 행(Row)
도메인(Domain)		도메인(Domain)		도메인(Domain)

엔티티 학생
속성 : 이름, 나이, 전공
주식별자 : 학번
도메인 : 나이(0 ~ 100)

+) 추가 용어
릴레이션(Relation)		테이블과 같은 개념, 튜플과 속성의 집합
튜플(Tuple)		릴레이션의 한 행(Row), 레코드 한개
속성(Attribute)		릴레이션의 한 열(Column), 컬럼 한 개
도메인(Domain)		속성이 가질 수 있는 값의 범위
디그리(Degree)		릴레이션(테이블)의 속성(컬럼)
카디널리티(Cardinality)	릴레이션(테이블)의 튜플(행)의 수
인스턴스(Instance)		실제 릴레이션에 저장된 데이터(행)들의 집합

+) 키 종류
기본키(Primary Key)	각 튜플을 유일하게 식별할 수 있는 속성(들), 대표키
			중복 불가, null 불가
후보키(Candidate Key)	기본키가 될 수 있는 후보들, 하나 이상의 후보키가 존재 할 수 있음
			유일성과 최소성을 만족해야함
			중복 불가, null 불가
대체키(Alternate Key)	후보키 중에서 기본키로 선택되지 않은 키
			유일성과 최소성을 만족해야함
외래키(Forgein Key)	다른 릴레이션의 기본키를 참조하는 속성, 릴레이션 간 관계를 맺을 때 사용
슈퍼키(Super Key)		튜플을 유일하게 식별할 수 있는 모든 속성 집합, 후보키보다 크거나 같음
			유일성만 만족해야함(최소성은 만족하지 않아도 됨)
유일성(Uniqueness)	릴레이션 내에서 키가 모든 튜플을 구분할 수 있어야함
			해당 속성에 대해 중복값이 없어야함
최소성(Minimality)	유일성을 만족하는 집합에서 불필요한 속성이 없어야함
			속성을 하나라도 제거하면 유일성이 깨지는 가장 작은 속성 집합이어야함

학생 테이블
학번		이름	이메일
20260101	짱구	gu@gmail.com
20260102	철수	su@gmail.com
20260103	유리	yuri@gmail.com

학번과 이메일은 유일한 값을 가짐 => 유일성 o
이름은 중복될 수 있음 => 유일성 x
학번	유일성 o, 최소성 x => 후보키o
이름	유일성 o, 최소성 의미없음 => x
이메일	유일성 o, 최소성 o => 후보키, 기본키, 대체키

슈퍼키	유일성o		행을 구분가능한 모든 키
후보키	유일성 o, 최소성 o	기본키 후보
기본키	후보키 중 선택	대표키
대체키	기본키 제외 후보키	보조키

------------------------------------------------------------------------------
[모델링 실습]
	요구사항 분석 -> 개념적 설계 -> 논리적 설계 -> 물리적 설계 -> 구현

1. 요구사항 분석
	핸드폰과 핸드폰 케이스를 판매한다
	핸드폰을 구매하면 핸드폰 케이스도 같이 구매한다
	핸드폰은 제품번호, 색상, 사이즈, 가격, 제조일, 할인률
	케이스는 제품번호, 색상, 가격
	핸드폰은 특정 케이스만 같이 구입할 수 있다

	부모테이블 핸드폰
	자식테이블 핸드폰케이스
	
	관계 : 핸드폰(부모) : 케이스(자식) = 1 : N

2. 개념적 설계 : 현실 모델링 단계(엔터티, 속성, 관계)

엔티티	핸드폰		케이스	
속성	제품번호 식별자	제품번호 식별자
	색상		색상
	사이즈		가격
	가격		
	제조일		
	할인률		

개념적 ERD (글자로 표현)
	[핸드폰] 1 - N [케이스]

3. 논리적 설계 : 테이블 구조 설계 단계(테이블명, 컬럼명, PK, FK, 관계)
엔터티 -> 테이블 구조로 변경

엔터티	핸드폰			케이스
속성	제품번호(PK) 숫자		제품번호(PK)숫자
	색상 NN 문자		색상 NN 문자
	사이즈 NN 숫자		가격 NN 숫자
	가격 NN 숫자		핸드폰 제품번호(FK)
	제조일 NN 날짜
	할인률  숫자

4. 물리적 설계 : DB에 맞게 구현단계(테이블명, 컬럼명, 자료형, 제약조건, 관계)
엔터티	핸드폰			케이스
속성	제품번호(PK) 숫자		제품번호(PK)숫자
	색상 NN 문자		색상 NN 문자
	사이즈 NN 숫자		가격 NN 숫자
	가격 NN 숫자		핸드폰 제품번호(FK)
	제조일 NN 날짜
	할인률  숫자

제약조건 => NN

	TBL_PHONE
	PHONE_NUMBER	NUMBER		PRIMARY KEY
	-------------------------------------------
	PHONE_COLOR	VARCHAR2(20)	NN
	PHONE_SIZE	VARCHAR2(20)	NN
	PHONE_PRICE	NUMBER		NN
	PHONE_DATE	DATE		NN
	PHONE_DISCOUNT	NUMBER(3, 2)	NN

	CASE
	CASE_NUMBER	NUMBER		PK
	CASE_COLOR	VARCHAR2	NN
	CASE_PRICE	NUMBER		NN
	PHONE_NUMBER	NUMBER		FK

5. 구현

[데이터베이스 설계단계]
	요구사항 분석 -> 개념적 설계 -> 논리적 설계 -> 물리적 설계 -> 구현

1) 요구사항 분석(Requirement Analysis)
	무엇을 만들 것 인가 정리하는 단계
	
	핸드폰과 케이스를 판매한다
	핸드폰은 제품번호, 색상, 사이즈, 가격, 제조일, 할인률을 가진다
	케이스는 제품번호, 색상, 가격을 가진다
	핸드폰은 1개당 여러개의 케이스를 가질 수 있다
	
	=> 시스템 목적, 필요한 정보, 관계, 제약사항

2) 개념적 설계
	현실세계 -> 개념모델
	
	ERD 작성
	DBMS 독립적
	개념 모델링

	=> 엔터티 도출, 속성 도출, 관계 설정, 식별자 결정

ERD 표현
	[핸드폰] 1 - N [케이스]
	엔터티 : 핸드폰, 케이스
	속성 : 제품번호, 색상, 가격, 사이즈, 제조일 ,할인률
	관계 : 핸드폰과 케이스는 1:N 관계
	식별자 : 제품번호

3) 논리적 설계(Logical Design)
	개념 -> 테이블 구조

	테이블 설계
	정규화 수행
	PK/FK 설정
	DBMS 독립적
	
	=> 릴레이션 생성, 기본키 정의, 외래키 정의, 무결성 규칙 설정	

핸드폰	(제품번호 PK, 색상, 사이즈, 가격, 제조일, 할인율)
케이스	(제품번호 PK, 색상, 가격, 폰제품번호 FK)

4) 물리적 설계(Physical Design)
	DBMS에 맞게 구현 준비

	저장구조 설계
	자료형 결정
	인덱스 설계
	성능 고려

	=> 데이터 타입, 길이, 제약조건, 인덱스, 저장공간

PHONE
	PHONE_ID NUMBER PRIMARY KEY,
	COLOR VARCHAR2(20) : NOT NULL
	PRICE NUMBER
	...

CASE
	...

5) 구현(Implementation)
	실제 SQL 작성 단계
	
	CREATE TABLE
	INSERT
	...

	=> 테이블 생성, 데이터 입력, 뷰 생성, ...

++) 모델링
	현실세계의 복잡한 상황이나 현상을 일정한 형식으로 표현하기 위하여 추상화(Abstraction)를 통하여 단순화 하는 과정

	현실세계 --- 모델링 ---> 모델(Model)
		  단순화
		  명료화
		  추상화(형상화)

- 모델링은 단순화를 목적으로 한다 : 복잡한 현실세계 현상을 이해하기 쉽게 요약해서 표현하는 기법
- 모델링은 명료화를 목적으로 한다 : 복잡한 현실세계 현상을 누구나 이해하기 쉽게 애매모호함을 제거하고 분명하고 또렷하게 표현하는 기법
- 모델링은 추상화를 목적으로 한다 : 복잡한 현실세계 현상을 이해하기 쉽게 설명하기 위해 중요한 특징을 찾아내어 구체적인 모양과 모습으로 형상화하는 기법

	모델링 행위는 대상의 엔티티(Entity, 엔터티)와 모델링을 수행하는 주제(Subject)로 구분할 수 있다
		엔티티 : 사람들의 관심이 되는 것, 업무에 꼭 필요로 하는 것들을 의미
		모델링 주체 : 모델링 수행하는 사람 모델러(modeller)

- 요구사항분석
- 개념적 설계(개념모델링)	엔티티를 사람들이 이해할 수 있는 개녕 세계의 정보 구조로 추상화하는 단계
- 논리적 설계(논리모델링)	실질적인 데이터 모델링에 해당함
			개념세계의 정보 구조를 정보시스템이 이해할 수 있는 형태로 표현하는 단계
- 물리적 설계(물리모델링)	정보시스템 세계의 논리적 구조를 정보시스템이 처리할 수 있는 형태로 구조화하는 단계
			구조화된 결과는 데이터 스키마로 표현됨
- 구현


# 1. 아래 요구사항을 분석하고 모델링 하시오(물리적모델링까지만 진행)
도서관에서 회원의 정보와 책의 정보가 필요하다.
회원의 정보는 회원번호, 이름, 나이, 핸드폰 번호, 주소가 필요하고
책의 정보는 도서번호, 책이름, 장르가 필요하다.
단, 장르는 인문학, 추리, IT, 로맨스
한 명의 회원은 여러권의 책을 빌릴 수 있다.
테이블 명 MEMBER, BOOK 

요구사항분석

도서관 회원 정보, 책 정보 관리
회원 정보는 회원번호, 이름, 나이, 핸드폰 번호, 주소가 있고
책의 정보는 도서번호, 책이름, 장르가 있다.
책 장르는 인문학, 추리, IT, 로맨스가 있고
한 명의 회원은 여러권의 책을 빌릴 수 있다.
테이블 명은 MEMBER, BOOK으로 지정한다

개념적설계

엔티티 => 회원 정보, 책 정보, 책 장르

속성 => 	회원 정보 : 회원번호, 이름, 나이, 핸드폰 번호, 주소
	책의 정보 : 도서번호, 책이름, 장르
	책 장르 : 인문학, 추리, IT, 로맨스
[회원] 1 - N [책]

회원정보		책정보		
회원번호		도서번호		
이름		책이름	
나이		장르		
핸드폰 번호			
주소

논리적 설계

회원정보		책정보	
회원번호(PK) 숫자	도서번호(PK) 숫자	
이름NN 문자	책이름NN 문자
나이NN 숫자	장르CHK 문자
핸드폰 번호NN 숫자	회원번호(FK) 숫자
주소NN 문자


물리적설계

MEMBER
MEMBER_NUMBER NUMBER : PRIMARY KEY
------------------------------------
MEMBER_NAME VARCHAR2(20) NOT NULL
MEMBER_AGE NUMBER NOT NULL
MEMBER_PHONE NUMBER NOT NULL
MEMBER_ADDRESS VARCHAR(100) NOT NULL

BOOK
BOOK_NUMBER NUMBER : PRIMARY KEY
-----------------------------------
BOOK_NAME VARCHAR2(100)
BOOK_CATEGORY VARCHAR2(20) CHECK
MEMBER_NUMBER NUMBER FOREIGN KEY






















